<%@page import="java.util.Date"%>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%
	String path = request.getContextPath();
	String basePath = request.getScheme() + "://" + request.getServerName() + ":" + request.getServerPort() + path + "/";
	Long dateStr = new Date().getTime();
%>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags" %>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta charset="UTF-8">
<title><spring:message code="mobile.realtime" /></title>
<base href="<%=basePath%>" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
<meta name="format-detection" content="telephone=no"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<!-- 不缓存 -->
<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="cache-control" content="no-cache">
<meta http-equiv="expires" content="0">


<link rel="icon" href="static/common/img/favicon.ico" />
<link rel="stylesheet" href="static/mobile/css/base.css?time=<%=dateStr%>"/>
<!-- <link rel="stylesheet"  href="/static/common/css/semantic.min.css" /> -->
<script type="text/javascript" src="static/common/js/jquery.min.js"></script>
<script type="text/javascript" src="static/common/js/jquery.cookie.js"></script>
<script type="text/javascript" src="static/common/js/highcharts.js"></script>
<script type="text/javascript" src="static/common/js/highcharts-more.js"></script>
<script type="text/javascript" src="static/common/js/solid-gauge.js"></script>

<script src="/static/manage/js/language.js"></script> 
<script src="/static/common/js/toolsMobile.js"></script> 
<script type="text/javascript" src="static/mobile/js/common.js"></script>


<style>
	body{
		background:#3fb493;
	}

	.container{
		height:13rem;
		margin-top:0.55rem 0.825rem 0;
		color:#ffffff;
	}
	.advices_tips{
		height:12.73rem;
		margin-top:.55rem .825rem 0;
		color:#ffffff;
		/* background:#efefef; */
		background:white;
		display:none;
		overflow:auto;
	}
	
	.advices_tips ul li{
		padding-bottom:0.25rem;
	}
	.advices_tips ul li img{
		width:40%;height:auto;
	}
	.backtoRealtime{
		width:2.5rem;
		height:.8rem;
		border-radius:2.5rem;
		text-align:center;
		line-height:.8rem;
		color:#565656;
		margin-top:0.35rem;
		margin-left:1.3rem;
		border:1px solid #565656;
	}
	.content{
		font-size:.6rem;
		line-height:.75rem;
		width:13rem;
		margin:.8rem auto 0;
		color:#565656;
	}
	.address img{
		/* background:url("../static/mobile/img/map.png") no-repeat left;
		background-size:0.85rem 1.35rem; */
		width:0.4rem;
		height:.675rem;
		color:#ffffff;
		font-size:.6rem;
		margin-left:.825rem;
		/* padding-left:1.4rem; */
		margin-top:.55rem;
		margin-bottom:1.7rem;
		/* border-bottom:1px solid #ffffff; */
	}
	.address .value{
		color:#ffffff;
		font-size:.6rem;
		border-bottom:1px solid #ffffff;
		margin-top:.55rem;
		margin-left:0.25rem;
	}
	.modify{
		width:5rem;
		height:.75rem;
		border:1px solid #ffffff;
		border-radius:2.5rem;
		background:url("../static/mobile/img/modify.png") no-repeat 0.5rem center;
		background-size:.6rem .6rem;
		color:#ffffff;
		font-size:.6rem;
		margin-right:.825rem;
		padding-left:1.05rem;
		margin-top:.55rem;
		line-height:.7rem;
		display:none;
	}
	.modify2{
		color:#565656;
		background-image:url("../static/mobile/img/settingicon.png");
		border:1px solid #565656;
		display:none;
	}
	.score{
		text-align:center;
		font-size:.85rem;
		line-height:1.2rem;
		color:#ffffff;
	}
	.rate{
		
	}
	.param li{
		width:50%;
		/* border-top:1px solid #fff; */
		border-right:1px solid #ffffff;
		border-bottom:1px solid #ffffff;
		box-sizing:border-box;
		height:3.5rem;
		float:left;
		color:#ffffff;
	}
	.param .wet, .param .temperature{
		border-top:1px solid #ffffff;
	}
	.param .wet, .param .wet{
		border-top:1px solid #ffffff;
	}
	.param .wet, .param .air{
		border-right:none;
	}
	.param .air{
		border-bottom:1px solid #ffffff;
	}
	.paramItem {
		margin-left:0.875rem;
		margin-top:.5rem;
		margin-bottom:0.0rem;
	}
	.icon img{
		width:auto;
		height:1.0rem;
		margin-right:0.15rem;
		font-size:.5rem;
		color:#ffffff;
	}
	.paramItem .txt{
		line-height:1.0rem;
		border-bottom:1px solid #fff;
		font-size:.6rem;
	}
	.wet .icon img{
		/* width:1rem; */
		height:.7rem;
	}
	.sun .icon img{
/* 		width:1.6rem; */
		height:.8rem;
	}
	.temperature .paramItem .icon img{
		margin-top:0.15rem;
	}
	.wet .paramItem .icon img{
		margin-top:0.15rem;
	}
	.air .paramItem .icon img{
		margin-top:0.25rem;
	}
	.sun .paramItem .icon img{
		margin-top:0.15rem;
	}
	.pm .paramItem .icon img{
		margin-top:0.15rem;
	}
	.air .icon img{
		/* width:1.25rem; */
		height:.5rem;
	}
	.pm .icon img{
		/* width:1.2rem; */
		height:.7rem;
	}
	.paramValue{
		padding-top:0.25rem;
	}
	.paramValue .tips{
		display:inline-block;
		margin-left:0;
		font-size:1rem; 
		width:4rem;
		text-align:right;
		line-height:1rem;
	}
	.param.en .paramValue .tips{
		margin-left:.5rem;
		margin-right:0;
		font-size:0.7rem; 
		width:3.5rem;
	}
	.param.en .paramValue .value{
		font-size:0.7rem; 
	}
	.paramValue .value{
		display:inline-block;
		width:2rem;
		text-align:left;
		margin-left:.5rem;
		font-size:1rem;
		line-height:1rem;
	}
	.wet .icon img,.air .icon img{
		margin-right:.875rem;
		margin-left:0.15rem;
	}
	
	.param{
		position:absolute;
		bottom:2.45rem;
	}
	
	/*add by chz*/
	#evaluation_title{
		position:absolute;
		top:2.08rem;
		font-size:1.0rem;
		color:#ffffff;
		text-align:center;
		width:100%;
		z-index:100;
	}
	
	#evaluation_value{
		position:absolute;
		top:6.25rem;
		left:0;
		display:inline-block;
		line-height:3rem;
		font-size:3rem;
		color:#ffffff;
		text-align:center;
		width:100%;
		z-index:100;
	}
	
	#evaluation_btn{
		position:absolute;
		top:10.5rem;
		width:8rem;
		left:50%;
		margin-left:-4rem;
		font-size:0.52rem;
		height:1.475rem;
		font-size:.65rem;
		color:#ffffff;
		text-align:center;
		height:1.5rem;
		line-height:.75em;
		z-index:100;
		border:2px solid #ffffff;
		border-radius:.75rem;
	}
	#evaluation_btn span{line-height:1.475rem;}
	#evaluation_chart{
	position:absolute;
		left:50%;
		top:3.5rem;
		width:6.93rem;
		height:6.775rem;
		margin-left:-3.465rem;
		left:50%;
	}
	.param.en .fl-r{float:right;margin-right:.6rem;}
	.isOnline{position:absolute;top:.55rem;right:.5rem;color:white;z-index:1000;font-size:.6rem;}
</style>
</head>
<body>

<!--内容区  -->
<div class="container" style="display:none;">
	<div class="isOnline" id="isOnline"></div>
	<div class="clearfix">
		<div class="fl address clearfix"><img src="../static/mobile/img/map.png" class="fl"/><span class="value fl"></span></div>
		<div class="fr modify" id="modify"><spring:message code="mobile.realtime_1" /></div>
	</div>
	
	<!--分数统计 -->
	<div class="score">
			<div id="evaluation_title"><spring:message code="mobile.realtime_2" /></div>
			<div id="evaluation_value"></div>
			<div id="evaluation_btn"><span><spring:message code="mobile.realtime_3" />&nbsp;</span><span id="opt_number"></span><span>&nbsp;<spring:message code="mobile.realtime_4" /></span></div>
			<div id="evaluation_chart"></div>
<!-- 		<div class="">室内环境品质</div> -->
<!-- 		<div class="rate"> -->
<!-- 			<div > -->
<!-- 				<span class="scoreNum">96</span> -->
<!-- 			</div> -->
<!-- 			<div class="advice" id="adviceBtn">室内环境可优化3项</div> -->
<!-- 		</div> -->
	</div>
	
</div>
<!--建议信息  -->
	<div class="advices_tips">
		<div class="clearfix">
			<div class="fl backtoRealtime"><spring:message code="mobile.realtime_return" /></div>
			<div class="fr modify modify2" id="modify2"><spring:message code="mobile.realtime_1" /></div>
		</div>
		<ul class="content">
				<li>
					<spring:message code="mobile.realtime_5" />
				</li>
<!-- 			<li> -->
<!-- 				1.这里是建议内容这里是建议内容这里是建议内容这里是建议内容。议内容这里是建议内容 -->
<!-- 			</li> -->
<!-- 			<li> -->
<!-- 				1.这里是建议内容这里是建议内容这里是建议内容这里是建议内容。议内容这里是建议内容 -->
<!-- 			</li> -->
<!-- 			<li> -->
<!-- 				1.这里是建议内容这里是建议内容这里是建议内容这里是建议内容。议内容这里是建议内容 -->
<!-- 			</li> -->
<!-- 			<li> -->
<!-- 				1.这里是建议内容这里是建议内容这里是建议内容这里是建议内容。议内容这里是建议内容 -->
<!-- 			</li> -->
<!-- 			<li> -->
<!-- 				1.这里是建议内容这里是建议内容这里是建议内容这里是建议内容。议内容这里是建议内容 -->
<!-- 			</li> -->
		</ul>
	</div>

<!-- 参数 -->
<ul class="param clearfix" style="display:none;">
	<li class="temperature" >
		<div class="paramItem clearfix" >
			<span class="icon fl"><img src="../static/mobile/img/temperature.png"/></span>
			<span class="fl txt" his_target="0"><spring:message code="mobile.realtime_temperature" /></span>
		</div>
		<div class="clearfix paramValue">
			<div class="tips fl" id="tem_tip"></div>
			<div class="value fl fl-r"  id="tem"></div>
		</div>
	</li>
	<li class="wet ">
		<div class="paramItem clearfix">
			<span class="icon fr"><img src="../static/mobile/img/wet.png"/></span>
			<span class="fr txt" his_target="1"><spring:message code="mobile.realtime_humidity" /></span>
		</div>
		<div class="clearfix paramValue">
			<div class="tips fl" id="hum_tip"></div>
			<div class="value fl fl-r" id="hum"></div>
		</div>
	</li>
	<li class="sun">
		<div class="paramItem clearfix">
			<span class="icon fl"><img src="../static/mobile/img/sun.png"/></span>
			<span class="fl txt" his_target="2"><spring:message code="mobile.realtime_intensity" /></span>
		</div>
		<div class="clearfix paramValue">
			<div class="tips fl" id="sun_tip"></div>
			<div class="value fl fl-r" id="sun"></div>
		</div>
	</li>
	<li class="air">
		<div class="paramItem clearfix ">
			<span class="icon fr"><img src="../static/mobile/img/air.png"/></span>
			<span class="fr txt" his_target="3"><spring:message code="mobile.realtime_CO2" /></span>
		</div>
		<div class="clearfix paramValue">
			<div class="tips fl" id="co2_tip"></div>
			<div class="value fl fl-r" id="co2"></div>
		</div>
	</li>
	<li class="pm" style="border-bottom:none;">
		<div class="paramItem clearfix">
			<span class="icon fl"><img src="../static/mobile/img/PM2.5.png"/></span>
			<span class="fl txt" his_target="4">PM2.5</span>
		</div>
		<div class="clearfix paramValue">
			<div class="tips fl" id="pm25_tip"></div>
			<div class="value fl fl-r" id="pm25"></div>
		</div>
	</li>
</ul>
<!--底部导航  -->
<ul class="footer clearfix">
	<li class="current" id="devicetab">
		<!-- <div class="icons"><img src="../static/mobile/img/device.png"/></div> -->
		<div class="icons"></div>
		<div class="txt"><spring:message code="mobile.realtime_device" /></div>
	</li>
	<li class="realtime" id="realtimetab">
		<!-- <div class="icons"><img src="../static/mobile/img/realtime.png"/></div> -->
		<div class="icons realtimeicon"></div>
		<div class="txt"><spring:message code="mobile.realtime_realtime" /></div>
	</li>
	<li class="history current" id="historytab">
		<!-- <div class="icons"><img src="../static/mobile/img/history.png"/><span class="arrow"></span></div> -->
		<div class="icons historyicon"><span class="arrow"></span></div>
		<div class="txt"><spring:message code="mobile.realtime_history" /></div>
	</li>
	<li class="evaluation" id="evaluationtab">
		<div class="icons evaluationicon"></div>
		<div class="txt">评估</div>
	</li>	
	<li class="home" id="hometab">
		<!-- <div class="icons"><img src="../static/mobile/img/home.png"/><span class="arrow"></span></div> -->
		<div class="icons homeicon"><span class="arrow"></span></div>
		<div class="txt"><spring:message code="mobile.realtime_room" /></div>
	</li>
</ul>
<!-- 悬浮返回 -->
<div class="return_to_list_float_btn"></div>


<script type="text/javascript">
if(localStorage.getItem("language")=="en"){
	$(".param").addClass("en");
	$(".return_to_list_float_btn").addClass("en");
}
	var device_id2=localStorage.getItem("device_id"); 
	

	var rate = 0;
	var tips = ["","","","",""];
	var colors = ["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"];
	var r_tem=1.0,r_hum=1.0,r_pm25=1.0,r_pm25_val,r_co2=1.0,r_sun=1.0,r_sum_val;
	var hum_value = 45;
	var tem_value = 20;
	var season = 1;/* 1冬季2夏季3过度季 */
	/* 通过日期判断季节 */
	function p(s) {
	    return s < 10 ? '0' + s: s;
	}
	var myDate = new Date();
	//获取当前月
	var month=myDate.getMonth()+1;
	//获取当前日
	var date=myDate.getDate(); 
	var now=p(month)+"-"+p(date);
	/* 6月15-9月15为夏季，11月15-3月15为冬季，其他时间为过度季 */
	if(now>="06-15" && now<="09-15"){
		season = 2;
	}else if(now>="03-15" && now<="11-15"){
		season = 1;
	}else{
		season = 3;
	}
	
	var showParams = false;
	
	var opt_count = 0;
	
	//判断是扫码进入还是登陆进入
	if($.cookie("login_type") == "device" || localStorage.getItem("login_type") == "device" ){
	 	/* alert("扫码登陆！");  */
		localStorage.setItem("device_id",$.cookie('device_id'));
	}
	
	function getRateAndTips(tem,hum,co2,pm25,sun){
		
		tips = ["","","","",""];
		colors = ["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"];
		r_tem=0,r_hum=0,r_pm25=0,r_co2=0,r_sun=0;
		opt_count = 5;
		
		hum_value = hum;
		tem_value = tem;
		
		
		var tempMin;
		var tempMax;
		if(season==1){
			tempMin = 16;
			tempMax = 20;
		}else if(season==2){
			tempMin = 24;
			tempMax = 28;
		}else{
			tempMin = 16;
			tempMax = 28
		}
		if(tem < tempMin){
			tips[0]  = getLangStr("mobile_realtime1");
			colors[0] = "#FFFB00";
		}else if(tem <= tempMax){
			r_tem = 1.0;
			opt_count -= 1;
			tips[0]  = getLangStr("mobile_realtime2");
		}else{
			tips[0]  = getLangStr("mobile_realtime3");
			colors[0] = "#FFFB00";
		}
		
		if(hum < 30){
			tips[1]  = getLangStr("mobile_realtime4");
			colors[1] = "#FFFB00";
		}else if(hum <= 60){
			r_hum = 1.0;
			tips[1]  = getLangStr("mobile_realtime5");
			opt_count -= 1;
		}else{
			tips[1]  = getLangStr("mobile_realtime5");
		}
		
		if(co2 < 600){
			r_co2 = 1.0;
			tips[3]  = getLangStr("mobile_realtime6");
			opt_count -= 1;
		}else if(co2 < 800){
			r_co2 = 0.75;
			tips[3]  = getLangStr("mobile_realtime7");
			opt_count -= 1;
		}else if(co2 < 1000){
			r_co2 = 0.5;
			tips[3]  = getLangStr("mobile_realtime8");
			opt_count -= 1;
		}else if(co2<=1500){
			r_co2 = 0.25;
			tips[3]  = getLangStr("mobile_realtime9");
			colors[3] = "#FFFB00";
		}else{
			r_co2 = 0.0;
			tips[3]  = getLangStr("mobile_realtime10");
			colors[3] = "#FFFB00";
		}
		r_sum_val = sun;
		if(sun >= 500){
			r_sun = 1.0;
			tips[4]  = getLangStr("mobile_realtime11");
			opt_count -= 1;
		}else if(sun >= 300){
			r_sun = 0.66;
			tips[4]  = getLangStr("mobile_realtime12");
			opt_count -= 1;
		}else if(sun >= 150){
			r_sun = 0.33;
			tips[4]  = getLangStr("mobile_realtime13");
			colors[4] = "#FFFB00";
		}else{
			r_sun = 0.0;
			tips[4]  = getLangStr("mobile_realtime14");
			colors[4] = "#FFFB00";
		}
		r_pm25_val = pm25;
		if(pm25 <= 50){
			r_pm25 = 1.0;
			tips[2]  = getLangStr("mobile_realtime15");
			opt_count -= 1;
		}else if(pm25 <= 100){
			r_pm25 = 0.66;
			tips[2]  = getLangStr("mobile_realtime16");
			opt_count -= 1;
		}else if(pm25 <= 150){
			r_pm25 = 0.33;
			tips[2]  = getLangStr("mobile_realtime17");
			colors[2] = "#FFFB00";
		}else{
			r_pm25 = 0.0;
			tips[2]  = getLangStr("mobile_realtime17");
			colors[2] = "#FFFB00";
		}
		
		var thermal = 0.6 * r_tem + 0.4 * r_hum;
		var iaq = 0.6 * r_co2 + 0.3 * r_pm25 + 0.1;
		var light = 1.0 * r_sun;
		var sound = 1.0;
		
		rate = 0.3 * thermal + 0.4 * iaq + 0.2 * light + 0.1 * sound;
		rate = Math.round(rate * 100);
		
	}
	
	function showCircle(value){
		
		
		Highcharts.chart('evaluation_chart', {

	        chart: {
	            type: 'solidgauge',
	            backgroundColor:"#3fb493"
	        },

	        title: {
	            text: '',
	            style: {
	                fontSize: '24px'
	            }
	        },
	        
	        credits:{
	        	enabled:false
	        },

	        tooltip: {
	        	enabled:false
	        },

	        pane: {
	            startAngle: 0,
	            endAngle: 360,
	            background: [{ // Track for Move
	                outerRadius: '110%',
	                innerRadius: '109%',
	                backgroundColor: '#D8D8D8',
	                borderWidth: 0
	            }]
	        },

	        yAxis: {
	            min: 0,
	            max: 100,
	            lineWidth: 0,
	            tickPositions: []
	        },

	        plotOptions: {
	            solidgauge: {
	                borderWidth: '2px',
	                dataLabels: {
	                    enabled: false
	                },
	                linecap: 'round',
	                stickyTracking: false
	            }
	        },

	        series: [{
	            name: "",
	            borderColor: "#ffffff",
	            data: [{
	                color: "#ffffff",
	                radius: '110%',
	                innerRadius: '109%',
	                y: value
	            }]
	        }]
	    });
		
		$("#evaluation_value").html(value);
	}
	
	function showTips(){
		$("#tem_tip").html(tips[0]);
		$("#hum_tip").html(tips[1]);
		$("#pm25_tip").html(tips[2]);
		$("#co2_tip").html(tips[3]);
		$("#sun_tip").html(tips[4]);
		
		$(".temperature .paramValue").css("color",colors[0]);
		$(".wet .paramValue").css("color",colors[1]);
		$(".pm .paramValue").css("color",colors[2]);
		$(".air .paramValue").css("color",colors[3]);
		$(".sun .paramValue").css("color",colors[4]);
		
		$("#opt_number").html(opt_count);
	}
		
	
	function update_strategy(){

		var stepCount = 1;
		var strategyHtml = "";
		
		var home_setting_initlized = localStorage.getItem("home_setting_initlized");
		
		if(home_setting_initlized == null || home_setting_initlized == false){
			init_home_setting();
		}		
		
		var floor_area = localStorage.getItem("floor_area");
		var people_number = localStorage.getItem("people_number");
		var window_number = localStorage.getItem("window_number");
		var ceil_light_number = localStorage.getItem("ceil_light_number");
		var desk_light_number = localStorage.getItem("desk_light_number");
		var has_air_cleaner = localStorage.getItem('has_air_cleaner');
		var has_air_new = localStorage.getItem('has_air_new');	
		var ac_form =  localStorage.getItem('ac_form');
		var roomshape = localStorage.getItem("shape");
		var windowarea = localStorage.getItem("window_area");

		var ss;
		/* 如果数据不全，则无法显示优化建议，更改提示 */
		/* if(floor_area==null || people_number==null || window_number==null || ceil_light_number==null || desk_light_number==null || has_air_cleaner==null){
			$("#evaluation_btn").html("<span>更新房间数据后显示优化</span>");
			$("#evaluation_btn").data("click","false");
		}else{
			$("#evaluation_btn").data("click","true");
		} */
		
		strategyHtml += buildStrategyStep(getLangStr("mobile_realtime18"));
		
		if(r_co2 <= 0.25){
			ss = stepCount +getLangStr("mobile_realtime19") + (50 * people_number) +getLangStr("mobile_realtime20");
			stepCount+=1;
			if(people_number <= 10){
				if(window_number >= 1){
					if(has_air_new==1){
						ss += getLangStr("mobile_realtime21");
					}else{
						ss += getLangStr("mobile_realtime22");	
					}
					
				}
			}else{
				if(window_number >= 2){
					if(has_air_new==1){
						ss += getLangStr("mobile_realtime23");
					}else{
						ss += getLangStr("mobile_realtime24");	
					}
				}else if(window_number >= 1){
					if(has_air_new==1){
						ss += getLangStr("mobile_realtime25");
					}else{
						ss += getLangStr("mobile_realtime26");	
					}
				}
			}
			
			if(r_pm25 < 0.5){
				if(has_air_cleaner == "1"){
					ss += getLangStr("mobile_realtime27");
				}
			}
			
			strategyHtml += buildStrategyStep(ss);
		}
		if(r_pm25 < 0.5){
			if(has_air_cleaner == "1"){
				ss = stepCount+getLangStr("mobile_realtime28")+r_pm25_val+getLangStr("mobile_realtime29")+(r_pm25_val/24).toFixed(2)+getLangStr("mobile_realtime30"); 
			}
			else{
			    ss = stepCount+getLangStr("mobile_realtime28")+r_pm25_val+getLangStr("mobile_realtime29")+(r_pm25_val/24).toFixed(2); 
			}
			stepCount++;
			strategyHtml += buildStrategyStep(ss);
		}
		 
		
		if(hum_value < 30){
			ss = stepCount + getLangStr("mobile_realtime31");
			stepCount+=1;
			strategyHtml += buildStrategyStep(ss);
		}
		
		if(r_sun < 0.5){
			if(window_number > 0){
				ss = stepCount + getLangStr("mobile_realtime32");
				if(ceil_light_number > 0 && desk_light_number>0){
					ss += getLangStr("mobile_realtime33");
				}else if(ceil_light_number > 0 ){
					ss += getLangStr("mobile_realtime34");
				}else if(desk_light_number > 0 ){
					ss += getLangStr("mobile_realtime35");
				}
			}else{
				if(ceil_light_number > 0 && desk_light_number>0){
					ss = stepCount + getLangStr("mobile_realtime36");
				}else if(ceil_light_number > 0 ){
					ss = stepCount + getLangStr("mobile_realtime37");
				}else if(desk_light_number > 0 ){
					ss = stepCount + getLangStr("mobile_realtime38");
				}
			}
			if(r_sun<0.3){
				ss+=getLangStr("mobile_realtime39")+r_sum_val+getLangStr("mobile_realtime40");	
			}
			stepCount+=1;
			strategyHtml += buildStrategyStep(ss);
			if(roomshape==1){
				strategyHtml += buildStrategyStep("<img src='/static/mobile/img/jxzm.jpg'>");
			}else if(roomshape==2){
				strategyHtml += buildStrategyStep("<img src='/static/mobile/img/lxzm.jpg'>");
			}else if(roomshape==3){
				strategyHtml += buildStrategyStep("<img src='/static/mobile/img/axzm.jpg'>");
			}else if(roomshape==4){
				strategyHtml += buildStrategyStep("<img src='/static/mobile/img/txzm.jpg'>");
			}
		}
		/* if(r_sun < 0.5){
			if(window_number > 0){
				ss = stepCount + ".室内照度太低，建议打开窗帘";
				if(ceil_light_number > 0 && desk_light_number>0){
					ss += "，如果还是太暗，建议同时打开顶灯或台灯";
				}else if(ceil_light_number > 0 ){
					ss += "，如果还是太暗，建议同时打开顶灯";
				}else if(desk_light_number > 0 ){
					ss += "，如果还是太暗，建议同时打开台灯";
				}
			}else{
				if(ceil_light_number > 0 && desk_light_number>0){
					ss = stepCount + ".室内照度太低，建议打开顶灯或台灯";
				}else if(ceil_light_number > 0 ){
					ss = stepCount + ".室内照度太低，建议打开顶灯";
				}else if(desk_light_number > 0 ){
					ss = stepCount + ".室内照度太低，建议打开台灯";
				}
			}
			
			stepCount+=1;
			strategyHtml += buildStrategyStep(ss);
		} */
		
		var tempMin;
		var tempMax;
		if(season==1){
			tempMin = 16;
			tempMax = 20;
		}else if(season==2){
			tempMin = 24;
			tempMax = 28;
		}else{
			tempMin = 16;
			tempMax = 28
		}
		if(tem_value < tempMin){
			if(season ==2){
				ss=stepCount+getLangStr("mobile_realtime41");
			}else if(season == 1){
				ss=stepCount+getLangStr("mobile_realtime42");
			}else{
				ss=stepCount+getLangStr("mobile_realtime43");
			}
			stepCount+=1;
			strategyHtml += buildStrategyStep(ss);
		}else if(tem_value <= tempMax){
			if(season ==2){
				ss=stepCount+getLangStr("mobile_realtime44");
			}else if(season ==1){
				ss=stepCount+getLangStr("mobile_realtime45");
			}else{
				ss=stepCount+getLangStr("mobile_realtime46");
			}
			stepCount+=1;
			strategyHtml += buildStrategyStep(ss);
		}else{
			if(season ==2){
				ss=stepCount+getLangStr("mobile_realtime47");
			}else if(season == 1){
				ss=stepCount+getLangStr("mobile_realtime48");
			}else{
				ss=stepCount+getLangStr("mobile_realtime49");
			}
			stepCount+=1;
			strategyHtml += buildStrategyStep(ss);
		}
		/* if(tem_value > 28){
			if(ac_form == 1){
				ss = stepCount + ".室内温度太高，建议下调室内设定温度，调小供暖热水阀门";
			}else if(ac_form == 4){
				ss = stepCount + ".室内温度太高，建议下调室内设定温度";
			}else{
				ss = stepCount + ".室内温度太高，建议调小供暖热水阀门";
			}
			stepCount+=1;
			strategyHtml += buildStrategyStep(ss);
		} */
		stepCount = 1;
		var kekaiqichuangdibi1 = window_number * 1.2 / floor_area;
		var kekaiqichuangdibi2 = window_number * 1.2 * 3.0 / floor_area;
		if(kekaiqichuangdibi1>0.08 || kekaiqichuangdibi2> 1/6.0 ){
			strategyHtml += buildStrategyStep(getLangStr("mobile_realtime50"));
		}
		
		if(kekaiqichuangdibi1>0.08){
			kekaiqichuangdibi1 = kekaiqichuangdibi1 * 100;
			var hqcs = "";
			var imgStr = "";
			if(roomshape==1){
				hqcs ="9.2-18.4"+getLangStr("mobile_realtime51");
				imgStr = "<img src='/static/mobile/img/jxtf.jpg'>";
			}else if(roomshape==2){
				hqcs ="8.5-17.0"+getLangStr("mobile_realtime51");
				imgStr = "<img src='/static/mobile/img/lxtf.jpg'>";
			}else if(roomshape==3){
				hqcs ="8.0-16.0"+getLangStr("mobile_realtime51");
				imgStr = "<img src='/static/mobile/img/axtf.jpg'>";
			}else if(roomshape==4){
				hqcs ="5.7-11.4"+getLangStr("mobile_realtime51");
				imgStr = "<img src='/static/mobile/img/txtf.jpg'>";
			}
			ss = stepCount + getLangStr("mobile_realtime52")+kekaiqichuangdibi1.toFixed(2)+getLangStr("mobile_realtime53")+windowarea/2+getLangStr("mobile_realtime54")+hqcs+getLangStr("mobile_realtime55");
			stepCount+=1;
			strategyHtml += buildStrategyStep(ss);
			strategyHtml += buildStrategyStep(imgStr);
		}
		
		if(kekaiqichuangdibi2> 1/6.0 ){
			kekaiqichuangdibi2 = kekaiqichuangdibi2 * 100;
			ss = stepCount + getLangStr("mobile_realtime56")+kekaiqichuangdibi2.toFixed(2)+getLangStr("mobile_realtime57");
			stepCount+=1;
			strategyHtml += buildStrategyStep(ss);
		}
		
		$(".advices_tips .content").html("");
		$(".advices_tips .content").append(strategyHtml);
	}
	
	function buildStrategyStep(s){
		var text = "<li>"
				   + s
				   + "</li>";
		return text;
	}
	
	
	$(document).ready(function(){ 
		addMobileLoading();
		
		
	 	var docHeight = $(document).height();
		var docWidth = $(document).width();
		 $(".content").css("width",docWidth*0.92);
		$("#evaluation_title").css("top",docHeight * 0.08);
		
	 	$("#evaluation_btn").css("top",docHeight * 0.4066);
		$("#evaluation_btn").css("width",docWidth * 0.60);
		$("#evaluation_btn").css("padding","0 .5rem");
		$("#evaluation_btn").css("margin-left","-"+docWidth * 0.3+"px");
		$("#evaluation_btn").css("font-size",docWidth * 0.039);
		$("#evaluation_btn").css("height",docHeight * 0.0672);
		$("#evaluation_btn span").css("line-height",docHeight * 0.0672+"px"); 
		
		$("#evaluation_chart").css("top",docHeight * 0.1183);
		$("#evaluation_chart").css("width",docWidth * 0.4435);
		$("#evaluation_chart").css("margin-left","-"+(docWidth * 0.22175)+"px");
		$("#evaluation_chart").css("height",docWidth * 0.4335);
		var valueheight = $("#evaluation_value").css("font-size").split("px")[0];
		$("#evaluation_value").css("top",(docWidth * 0.4335/2)+(docHeight * 0.1183)-(valueheight/2));//docHeight * 0.24 
		$(".param li").css("height",docHeight *0.13);
		$(".paramItem").css("margin-left",docWidth*0.06);
		$(".paramItem").css("margin-top",docWidth*0.02);
		$(".paramValue").css("padding-top",docWidth*0.025);   
		$(".paramItem .txt").css("line-height",docWidth*0.064+"px");
		$(".icon img").css("height",docWidth*0.055+"px");
		$(".wet .icon img").css("height",docWidth*0.0448+"px");
		$(".sun .icon img").css("height",docWidth*0.0512+"px");
		$(".air .icon img").css("height",docWidth*0.032+"px");
		$(".pm .icon img").css("height",docWidth*0.0448+"px");
		showCircle(0);
		
		$("#evaluation_btn").click(function(){
			
				$(".container").css("display","none");
				$(".advices_tips").css("display","block");
			
		});
		$(".backtoRealtime").click(function(){
			$(".container").css("display","block");
			$(".advices_tips").css("display","none");
		});
		
		$(".advices_tips").css("height",docHeight - $(".param").height() - $(".footer").height());
		/* 如果是扫码进入的话，重新获取地址，并且将cookie中id存入localStorage */
		if($.cookie("login_type") == "device" || localStorage.getItem("login_type") == "device" ){
			$.ajax({
		        type: "post",
		        dataType: "json",
		        async: false,
		        url: '/device/info',
		        data:{
		        	 deviceID:$.cookie('device_id')
		        },
		        success: function (data) {
		        	 if(data.code==200){
		        		 var device=data.device;
		        		 device_address = device.address
		        		 localStorage.setItem("device_address",device_address);
		        	 }
		        	removeLoading();
		        } 
		    });
			localStorage.setItem("device_id",$.cookie('device_id'));
		}
		
		var device_id = localStorage.getItem("device_id");
		/* 根据设备ID获取在线状态 */
		/* $.ajax({
			url:"/device/status",
			type:"POST",
			data:{"deviceID":id},
			success:function(response){
				if(response.code == 200){
					var this_status;
					if(response.status==true){
						this_status = getLangStr("deviceList_online");
					}else{
						this_status = getLangStr("deviceList_notonline");
					}
					
					$thisRow.find("#device_status").html(this_status);
				}
				
			}
		 }); */
		var device_address = localStorage.getItem("device_address");
		$(".address .value").html(device_address);
		
		$(".address").click(function(){
			var timestamp = Date.parse(new Date());
        	timestamp = timestamp / 1000;
			window.location.href = "/open?url=mobile/deviceDetail.jsp?timestamp="+timestamp;
		});
		/* 加载完毕再显示container*/
		$(".container").css("display","block");
		$(".param.clearfix").css("display","block");
		
		$.ajax({
	        type: "post",
	        dataType: "json",
	        url: '/device/realtime',
	        data:{
	        	deviceId:device_id
	        },
	        success: function (result) {
	        	if(result.status == 0){
	        		//是否在线
	        		var zt = result.zt?getLangStr("deviceList_online"):getLangStr("deviceList_notonline");
	        		$("#isOnline").html(zt);
	        		if(result.zt){
	        			//显示校准数据
		        		$("#tem").html(result.data.tem);
		        		$("#hum").html(result.data.hum);
		        		$("#pm25").html(result.data.pm);
		        		$("#co2").html(result.data.co2);
		        		$("#sun").html(result.data.lightIntensity);
	    		
		        		getRateAndTips(result.data.tem,result.data.hum,result.data.co2,result.data.pm,result.data.lightIntensity);
		        		showCircle(rate);
		        		showTips();
		        	
		        		update_strategy();
	        		}else{
	        			//发现0条可优化
	        			$("#opt_number").html(0);
	        			//环境品质图
	        			$("#evaluation_value").html("-");
	        			//各项系数
	        			$("#tem_tip").html("-");
	        			$("#hum_tip").html("-");
	        			$("#sun_tip").html("-");
	        			$("#co2_tip").html("-");
	        			$("#pm25_tip").html("-");
	        		}
	        		
	        	}else{ 
	        		//校准数据读取失败，进行提示
	        		alert(result.msg);
	        	}
	        	removeLoading();
	        },
	        error:function (XMLHttpRequest, textStatus, errorThrown) 
	        { 
	        	//alert(textStatus);
	        	deviceOnline = false;   
	        } 
	    });
		
		$(".paramItem .txt").click(function(){
			localStorage.setItem("his_target",$(this).attr("his_target"));
			var timestamp = Date.parse(new Date());
        	timestamp = timestamp / 1000;
			window.location.href = "/open?url=mobile/historyData.jsp?timestamp="+timestamp;
		});
		
	});
</script>

</body>
</html>